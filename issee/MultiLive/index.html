
<!DOCTYPE html>
<html>
    <head>
        <title>Multi Live Player</title>
        <meta name="copyrights" content="Michael Boccara @Blueturn 2025" />
        <link rel="stylesheet" href="style.css">
    </head>
    <body style="background-color:black;" onresize="resize()">
        <div class="mosaic">
            <div class="tile">
                <iframe 
                    class="iss-tracker"
                    id="issTracker"
                    src="../ESA_ISSTracker/index.html" 
                    scrolling="no" 
                    width="625" 
                    height="352">
                </iframe>
                <div id="locationButtons">
                    <button id="myLocBtn">My location</button>
                    <button class="prevPassBtn">Last Pass</button>
                    <button class="nextPassBtn">Next Pass</button>
                </div>
                <div id="curLocLabel">Current location</div>
                <div id="timeButtons">
                    <button onclick="addDelay(300)">-5min</button>
                    <button onclick="addDelay(60)">-1min</button>
                    <button onclick="addDelay(5)">-5sec</button>
                    <button onclick="goLive()">Live</button>
                    <button onclick="addDelay(-5)">+5sec</button>
                    <button onclick="addDelay(-60)">+1min</button>
                    <button onclick="addDelay(-300)">+5min</button>
                </div>
            </div>
            <div class="tile" id="yt_NasaFront">Loading YouTube Player 2...</div>
            <div class="tile" id="yt_NasaTopDown">Loading YouTube Player 3...</div>
            <div class="tile" id="yt_Sen">Loading YouTube Player 1...</div>
            <div class="tile" id="windyTile">
                <iframe id="windyIFrame" width="440" height="300" src="https://embed.windy.com/embed.html?type=map&zoom=2&overlay=satellite" frameborder="0"></iframe>
                <!-- <iframe width="440" height="300" src="https://www.windy.com/-Satellite-satellite?satellite,32.080,34.781,5,p:cams" frameborder="0"></iframe> -->
            </div>
        </div>
        <script type="module">
            import LivePlayer from '../Lib/LivePlayer.js';
            import YouTubeLivePlayer from '../Lib/YouTubeLivePlayer.js';
            import ISSTrackerNode from '../Lib/ISSTrackerNode.js';
            import ISSLocator from '../Lib/ISSLocator.js';

            new YouTubeLivePlayer("fO9e9jnhYK8", "yt_Sen"); // Sen camera
            // TODO: https://app.blueturn.earth/issee/StereoSat/?v=fO9e9jnhYK8&timeOffset=7&videoRotation=90&videoPanXpc=19&videoScale=10
            new YouTubeLivePlayer("iYmvCUonukw", "yt_NasaFront"); // ISS front
            new YouTubeLivePlayer("yf5cEJULZXk", "yt_NasaTopDown"); // ISS topdown
            // TODO: https://app.blueturn.earth/issee/StereoSat/?v=yf5cEJULZXk&timeOffset=-14&videoRotation=-3&videoPanXpc=22&videoScale=10
            new ISSTrackerNode("issTracker");
            // TODO: Add Windy + Webcam
            // TODO: Add 3D Cesium

            const curLocLabel = document.getElementById("curLocLabel");
            const windyIFrame = document.getElementById("windyIFrame");
            let lastWindyLat;
            let lastWindyLon;
            const windyThresLatLon = 10; // degrees
            new ISSLocator(
                "myLocBtn", 
                "prevPassBtn", 
                "nextPassBtn", 
                "iss-tracker",
                (lastPassDelay) => {
                    LivePlayer.group.setDelay(lastPassDelay);
                },
                (lat, lon, data) => {
                    let locationName = "Unknown location";
                    if (data.country)
                    {
                        if (data.natural_feature)
                            locationName = data.natural_feature + ', ' + data.country;
                        else if (data.administrative_area_level_1)
                            locationName = data.administrative_area_level_1 + ', ' + data.country;
                        else
                            locationName = data.country;
                    }
                    curLocLabel.innerHTML = locationName;
                    // Update Windy only if moved enough
                    if (!lastWindyLat || !lastWindyLon || Math.abs(lat - lastWindyLat) > windyThresLatLon || Math.abs(lon - lastWindyLon) > windyThresLatLon)
                    {
                        lastWindyLat = lat;
                        lastWindyLon = lon;
                        //console.log("Updating Windy to lat=" + lat + " lon=" + lon);
                        windyIFrame.src = "https://embed.windy.com/embed.html?lat=" + lat + "&lon=" + lon + "&zoom=2&type=map&overlay=satellite";
                    }
                });

            export function resize() {
                const issDiv = document.getElementById("issTracker");
                const issTrackerWidth = 1;
                const issTrackerMaxHeight = 0.8;
                let issTrackerScale = issDiv.parentNode.offsetWidth / issDiv.offsetWidth * issTrackerWidth;
                const issTrackerHeight = issDiv.offsetHeight * issTrackerScale / issDiv.parentNode.offsetHeight; 
                if (issTrackerHeight > issTrackerMaxHeight)
                    issTrackerScale = issDiv.parentNode.offsetHeight / issDiv.offsetHeight * issTrackerMaxHeight;
                console.log("issTrackerScale=" + issTrackerScale);
                issDiv.style.transform =  "scale(" + issTrackerScale + ")";
            }
            window.resize = resize;
            resize();

        </script>
    </body>
</html>